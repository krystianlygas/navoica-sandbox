{"version":3,"sources":["webpack:///./lms/static/js/learner_dashboard/entitlement_unenrollment_factory.js","webpack:///./lms/static/js/learner_dashboard/views/entitlement_unenrollment_view.js","webpack:///external \"jQuery\"?0cb8********","webpack:///external \"Backbone\"?709d*****","webpack:///external \"_\"?b3b9*****"],"names":["EntitlementUnenrollmentFactory","options","EntitlementUnenrollmentView","defaults","el","view","closeButtonSelector","headerTextSelector","errorTextSelector","submitButtonSelector","triggerSelector","mainPageSelector","genericErrorMsg","gettext","modalId","$el","attr","dashboardPath","signInPath","browseCourses","isEdx","$submitButton","$","$closeButton","$headerText","$errorText","on","handleSubmit","bind","each","setUpTrigger","$trigger","handleTrigger","window","accessible_modal","event","target","courseName","data","courseNumber","apiEndpoint","$previouslyFocusedElement","resetModal","setHeaderText","setSubmitData","css","undefined","setError","prop","ajax","url","method","complete","onComplete","removeData","empty","removeClass","message","HtmlUtils","setHtml","addClass","interpolateHtml","survey","document","querySelector","i","children","length","appendChild","Math","trunc","random","trapFocusForAccessibleModal","focusableElementsString","reason","val","analytics","track","category","label","displayName","xhr","status","responseJSON","detail","switchToSlideOne","click","switchToSlideTwo","redirectTo","encodeURIComponent","path","location","href","Backbone","View"],"mappings":"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","file":"EntitlementUnenrollmentFactory.js","sourcesContent":["import EntitlementUnenrollmentView from './views/entitlement_unenrollment_view';\n\nfunction EntitlementUnenrollmentFactory(options) {\n  return new EntitlementUnenrollmentView(options);\n}\n\nexport { EntitlementUnenrollmentFactory }; // eslint-disable-line import/prefer-default-export\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/entitlement_unenrollment_factory.js","/* globals gettext */\n\nimport Backbone from 'backbone';\n\nimport HtmlUtils from 'edx-ui-toolkit/js/utils/html-utils';\n\nclass EntitlementUnenrollmentView extends Backbone.View {\n  constructor(options) {\n    const defaults = {\n      el: '.js-entitlement-unenrollment-modal',\n    };\n    super(Object.assign({}, defaults, options));\n  }\n\n  initialize(options) {\n    const view = this;\n\n    this.closeButtonSelector = '.js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-close-btn';\n    this.headerTextSelector = '.js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-header-text';\n    this.errorTextSelector = '.js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-error-text';\n    this.submitButtonSelector = '.js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-submit';\n    this.triggerSelector = '.js-entitlement-action-unenroll';\n    this.mainPageSelector = '#dashboard-main';\n    this.genericErrorMsg = gettext('Your unenrollment request could not be processed. Please try again later.');\n    this.modalId = `#${this.$el.attr('id')}`;\n\n    this.dashboardPath = options.dashboardPath;\n    this.signInPath = options.signInPath;\n    this.browseCourses = options.browseCourses;\n    this.isEdx = options.isEdx;\n\n    this.$submitButton = $(this.submitButtonSelector);\n    this.$closeButton = $(this.closeButtonSelector);\n    this.$headerText = $(this.headerTextSelector);\n    this.$errorText = $(this.errorTextSelector);\n\n    this.$submitButton.on('click', this.handleSubmit.bind(this));\n\n    $(this.triggerSelector).each(function setUpTrigger() {\n      const $trigger = $(this);\n\n      $trigger.on('click', view.handleTrigger.bind(view));\n\n      // From accessibility_tools.js\n      if (window.accessible_modal) {\n        window.accessible_modal(\n          `#${$trigger.attr('id')}`,\n          view.closeButtonSelector,\n          `#${view.$el.attr('id')}`,\n          view.mainPageSelector,\n        );\n      }\n    });\n  }\n\n  handleTrigger(event) {\n    const $trigger = $(event.target);\n    const courseName = $trigger.data('courseName');\n    const courseNumber = $trigger.data('courseNumber');\n    const apiEndpoint = $trigger.data('entitlementApiEndpoint');\n\n    this.$previouslyFocusedElement = $trigger;\n\n    this.resetModal();\n    this.setHeaderText(courseName, courseNumber);\n    this.setSubmitData(apiEndpoint);\n    this.$el.css('position', 'fixed');\n  }\n\n  handleSubmit() {\n    const apiEndpoint = this.$submitButton.data('entitlementApiEndpoint');\n\n    if (apiEndpoint === undefined) {\n      this.setError(this.genericErrorMsg);\n      return;\n    }\n\n    this.$submitButton.prop('disabled', true);\n    $.ajax({\n      url: apiEndpoint,\n      method: 'DELETE',\n      complete: this.onComplete.bind(this),\n    });\n  }\n\n  resetModal() {\n    this.$submitButton.removeData();\n    this.$submitButton.prop('disabled', false);\n    this.$headerText.empty();\n    this.$errorText.removeClass('entitlement-unenrollment-modal-error-text-visible');\n    this.$errorText.empty();\n  }\n\n  setError(message) {\n    this.$submitButton.prop('disabled', true);\n    this.$errorText.empty();\n    HtmlUtils.setHtml(\n                        this.$errorText,\n                        message,\n                    );\n    this.$errorText.addClass('entitlement-unenrollment-modal-error-text-visible');\n  }\n\n  setHeaderText(courseName, courseNumber) {\n    this.$headerText.empty();\n    HtmlUtils.setHtml(\n      this.$headerText,\n      HtmlUtils.interpolateHtml(\n        gettext('Are you sure you want to unenroll from {courseName} ({courseNumber})? You will be refunded the amount you paid.'), // eslint-disable-line max-len\n        {\n          courseName,\n          courseNumber,\n        },\n      ),\n    );\n  }\n\n  setSubmitData(apiEndpoint) {\n    this.$submitButton.removeData();\n    this.$submitButton.data('entitlementApiEndpoint', apiEndpoint);\n  }\n\n  switchToSlideOne() {\n    // Randomize survey option order\n    const survey = document.querySelector('.options');\n    for (let i = survey.children.length - 1; i >= 0; i -= 1) {\n      survey.appendChild(survey.children[Math.trunc(Math.random() * i)]);\n    }\n    this.$('.entitlement-unenrollment-modal-inner-wrapper header').addClass('hidden');\n    this.$('.entitlement-unenrollment-modal-submit-wrapper').addClass('hidden');\n    this.$('.slide1').removeClass('hidden');\n\n    // From accessibility_tools.js\n    window.trapFocusForAccessibleModal(\n      this.$previouslyFocusedElement,\n      window.focusableElementsString,\n      this.closeButtonSelector,\n      this.modalId,\n      this.mainPageSelector,\n    );\n  }\n\n  switchToSlideTwo() {\n    let reason = this.$(\".reasons_survey input[name='reason']:checked\").attr('val');\n    if (reason === 'Other') {\n      reason = this.$('.other_text').val();\n    }\n    if (reason) {\n      window.analytics.track('entitlement_unenrollment_reason.selected', {\n        category: 'user-engagement',\n        label: reason,\n        displayName: 'v1',\n      });\n    }\n    this.$('.slide1').addClass('hidden');\n    this.$('.slide2').removeClass('hidden');\n\n    // From accessibility_tools.js\n    window.trapFocusForAccessibleModal(\n      this.$previouslyFocusedElement,\n      window.focusableElementsString,\n      this.closeButtonSelector,\n      this.modalId,\n      this.mainPageSelector,\n    );\n  }\n\n  onComplete(xhr) {\n    const status = xhr.status;\n    const message = xhr.responseJSON && xhr.responseJSON.detail;\n\n    if (status === 204) {\n      if (this.isEdx) {\n        this.switchToSlideOne();\n        this.$('.reasons_survey:first .submit-reasons').click(this.switchToSlideTwo.bind(this));\n      } else {\n        EntitlementUnenrollmentView.redirectTo(this.dashboardPath);\n      }\n    } else if (status === 401 && message === 'Authentication credentials were not provided.') {\n      EntitlementUnenrollmentView.redirectTo(`${this.signInPath}?next=${encodeURIComponent(this.dashboardPath)}`);\n    } else {\n      this.setError(this.genericErrorMsg);\n    }\n  }\n\n  static redirectTo(path) {\n    window.location.href = path;\n  }\n}\n\nexport default EntitlementUnenrollmentView;\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/views/entitlement_unenrollment_view.js","(function() { module.exports = window[\"jQuery\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = 4 5 6 9 10 12 13 14 16 17 18 19 20 21 22 23 24 25 26 29","(function() { module.exports = window[\"Backbone\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Backbone\"\n// module id = 1\n// module chunks = 4 5 6 9 10 14 16 17","(function() { module.exports = window[\"_\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"_\"\n// module id = 2\n// module chunks = 4 5 6 9 10 14 16"],"sourceRoot":""}